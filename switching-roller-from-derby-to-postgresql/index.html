<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Switching roller from Derby to PostgreSQL - The Datapile</title>




<meta name="description" content="Since Roller seems to have problems with the Glassfish built-in Derby database, especially when it comes to Full preview (you might end up with an HTTP 404 error code if you try to preview your post), you might want to switch your Roller installation to PostgreSQL.">




<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Datapile">
<meta property="og:title" content="Switching roller from Derby to PostgreSQL">


  <link rel="canonical" href="https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/">
  <meta property="og:url" content="https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/">



  <meta property="og:description" content="Since Roller seems to have problems with the Glassfish built-in Derby database, especially when it comes to Full preview (you might end up with an HTTP 404 error code if you try to preview your post), you might want to switch your Roller installation to PostgreSQL.">



  <meta name="twitter:site" content="@authsec">
  <meta name="twitter:title" content="Switching roller from Derby to PostgreSQL">
  <meta name="twitter:description" content="Since Roller seems to have problems with the Glassfish built-in Derby database, especially when it comes to Full preview (you might end up with an HTTP 404 error code if you try to preview your post), you might want to switch your Roller installation to PostgreSQL.">
  <meta name="twitter:url" content="https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2010-10-31T14:00:34+01:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Jens Frey",
      "url" : "https://datapile.coffeecrew.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://datapile.coffeecrew.org/feed.xml" type="application/atom+xml" rel="alternate" title="The Datapile Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://datapile.coffeecrew.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://datapile.coffeecrew.org/">The Datapile</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/year-archive/">Archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://mmistakes.github.io/minimal-mistakes/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/categories/">Categories archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/tags/">Tags</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Switching roller from Derby to PostgreSQL</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  


  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://datapile.coffeecrew.org/images/me.png" class="author__avatar" alt="" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name"></h3>
    
      <p class="author__bio" itemprop="description">
        Developer. Musician.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Lörrach</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      
        <li>
          <a href="https://plus.google.com/+JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+
          </a>
        </li>
      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.youtube.com/user/../c/JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-youtube-square" aria-hidden="true"></i> YouTube
          </a>
        </li>
      

      
        <li>
          <a href="https://soundcloud.com/john-c-flow" itemprop="sameAs">
            <i class="fa fa-fw fa-soundcloud" aria-hidden="true"></i> Soundcloud
          </a>
        </li>
      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  
  <img src="/images/software.png" alt="Software" style="padding-bottom: 1em;">
    
    <div><a href="" class="badge1" data-badge="4.1">Roller Weblogger</a></div>
    
    <div><a href="" class="badge1" data-badge="v2UR2">Glassfish</a></div>
    
    <div><a href="" class="badge1" data-badge="8.3.4">PostgreSQL</a></div>
    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Switching roller from Derby to PostgreSQL">
    <meta itemprop="description" content="Since Roller seems to have problems with the Glassfish built-in Derby database, especially when it comes to Full preview (you might end up with an HTTP 404 error code if you try to preview your post), you might want to switch your Roller installation to PostgreSQL.">
    <meta itemprop="datePublished" content="October 31, 2010">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Switching roller from Derby to PostgreSQL
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  3 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Since Roller seems to have problems with the Glassfish built-in Derby database, especially when it comes to <q>Full preview</q> (you might end up with an HTTP 404 error code if you try to preview your post), you might want to switch your Roller installation to <a href="http://www.postgresql.org/">PostgreSQL</a>.</p>

<p>This article will explain, how you can switch the installed Roller instance from Glassfish’s built-in derby database to the PostgreSQL database.</p>

<h2 id="quick-install">Quick install</h2>

<p>For the people who don’t care if anything goes wrong or just don’t like to type at all, <a href="https://gist.github.com/authsec/a048fb1d1ade8004dd55f4ede17c077b">here is a litte script</a>, which might help you save a few keystrokes. Just be aware of the fact that you might have to change a few variables inside the script.</p>

<h2 id="manual-installation">Manual installation</h2>

<p>This describes basically what the script in the quick installation tries to achive by being run.</p>

<h3 id="prerequisites">Prerequisites</h3>

<p>As with the roller install itself, you need of course a few things before you can start. In this case you need of course the <a href="http://www.postgresql.org/">PostgreSQL</a> database itself and a JDBC driver to attach roller to the database.</p>

<p>The installation of the database depends on the type of operating system you are using. I describe the setup using a <a href="http://www.debian.org/">Debian</a> based system, since this is so nice and easy :).</p>

<h3 id="get-the-database-driver">Get the database driver</h3>

<p>To enable Glassfish to talk to your postgres installation, you have to supply it some code. Glassfish likes Java the best and you can get some JDBC drivers from <a href="http://jdbc.postgresql.org/download.html">here</a>, but specifically the <a href="http://jdbc.postgresql.org/download/postgresql-8.3-604.jdbc3.jar">postgresql-8.3-604.jdbc3.jar</a> is of interest to us.</p>

<p>So go get the JDBC driver and save it in <code class="highlighter-rouge">/opt/roller/glassfish/domains/roller/lib</code></p>

<h3 id="install-database">Install database</h3>

<p>For a debian based system just enter the following command as user root (or prefix it with sudo on ubuntu). You might of course have a newer version of postgresql available with you current installation.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>  root@sigusr1:<span class="nv">$ </span>aptitude install postgresql-8.1
</code></pre>
</div>

<p>After the installation finishes, you might want to create the database roller will be accessing later and also create a user for use with roller. This can be achieved by entering the following sequence of commands into a terminal of your choice.</p>

<p class="notice--info"><strong>Note:</strong> Be aware of the fact that you have to <em>execute</em> the commands as user <em>postgres</em>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>root@sigusr1:<span class="err">$</span>
	       <span class="c"># Get root</span>
	       su -

	       <span class="c"># Get postgres user</span>
	       su - postgres

	       <span class="c"># create database</span>
	       createdb rollerdb

	       <span class="c"># create roller user</span>
	       createuser roller
	       <span class="c"># Answers</span>
	       <span class="c"># Shall the new role be a superuser? (y/n) n</span>
	       <span class="c"># Shall the new role be allowed to create databases? (y/n) n</span>
	       <span class="c"># Shall the new role be allowed to create more new roles? (y/n) n</span>

	       <span class="c"># Enter postgres prompt</span>
	       psql
</code></pre>
</div>

<p>When you are in the prompt which will look something like this:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="n">Welcome</span> <span class="k">to</span> <span class="n">psql</span> <span class="mi">8</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="n">the</span> <span class="n">PostgreSQL</span> <span class="n">interactive</span> <span class="n">terminal</span><span class="p">.</span>

<span class="k">Type</span><span class="p">:</span>  <span class="err">\</span><span class="n">copyright</span> <span class="k">for</span> <span class="n">distribution</span> <span class="n">terms</span>
       <span class="err">\</span><span class="n">h</span> <span class="k">for</span> <span class="n">help</span> <span class="k">with</span> <span class="k">SQL</span> <span class="n">commands</span>
       <span class="err">\</span><span class="o">?</span> <span class="k">for</span> <span class="n">help</span> <span class="k">with</span> <span class="n">psql</span> <span class="n">commands</span>
       <span class="err">\</span><span class="k">g</span> <span class="k">or</span> <span class="k">terminate</span> <span class="k">with</span> <span class="n">semicolon</span> <span class="k">to</span> <span class="k">execute</span> <span class="n">query</span>
       <span class="err">\</span><span class="n">q</span> <span class="k">to</span> <span class="n">quit</span>

<span class="n">postgres</span><span class="o">=#</span>
</code></pre>
</div>

<p>Enter the following SQL statements which change the passwords for the roller<br />
and postgres user accordingly:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">alter</span> <span class="k">user</span> <span class="n">roller</span> <span class="k">with</span> <span class="n">password</span> <span class="s1">'roller'</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">user</span> <span class="n">postgres</span> <span class="k">with</span> <span class="n">password</span> <span class="s1">'postgres'</span><span class="p">;</span>
</code></pre>
</div>

<p>You are now finished using the postgres user. You may want to continue as user roller with the following commands.</p>

<p>If you followed the <a href="/setup-roller-weblogger-4-1-on-glassfish-v2/">Setup Roller Weblogger 4.1 On Glassfish V2</a> tutorial, you do have to do an additional step to get rid of the previously assigned JDBC connection; that is deleting the JDBC connection pool. Aside from that we simply create a JDBC connection pool and the according resource. Once that is done you might want to start configuring your roller installation.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>root@sigusr1:<span class="err">$</span>
 	       <span class="c">#if you followed glassfish ... (cleans jdbc resource too)</span>
 	       ./bin/asadmin delete-jdbc-connection-pool --cascade rollerpool

 	       ./bin/asadmin create-jdbc-connection-pool
 	       --datasourceclassname org.postgresql.ds.PGSimpleDataSource <span class="se">\</span>
 	       --restype javax.sql.DataSource <span class="se">\</span>
 	       --property <span class="nv">portNumber</span><span class="o">=</span>5432:password<span class="o">=</span>roller:user<span class="o">=</span>roller:serverName<span class="o">=</span>localhost:databaseName<span class="o">=</span>rollerdb <span class="se">\</span>
 	       rollerpool

 	       ./bin/asadmin ping-connection-pool rollerpool
  	       ./bin/asadmin create-jdbc-resource --connectionpoolid<span class="o">=</span>rollerpool jdbc/rollerdb
</code></pre>
</div>

<p>Once that is finished, you should restart Glassfish in order to make changes effective. This is done through the following command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">root@sigusr1:$ </span>su - roller -c <span class="s2">"cd glassfish; ./bin/asadmin stop-domain roller"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
su - roller -c <span class="s2">"cd glassfish; ./bin/asadmin start-domain roller"</span>
</code></pre>
</div>

<p>When you have finished all that, you now should be able to point you browser to <a href="http://localhost:8080/blogs">http://localhost:8080/blogs</a> and start configuring your Roller installation. Have fun.</p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2010-10-31T14:00:34+01:00">October 31, 2010</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=authsec&text=Switching roller from Derby to PostgreSQL https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://datapile.coffeecrew.org/switching-roller-from-derby-to-postgresql/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://datapile.coffeecrew.org/music/originals/free-iphone-ringtone-1/" class="pagination--pager" title="Free iPhone Ringtone #1
">Previous</a>
    
    
      <a href="https://datapile.coffeecrew.org/backing-up-roller-weblogger/" class="pagination--pager" title="Backing up roller weblogger
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/authsec"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/authsec"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://datapile.coffeecrew.org/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Jens Frey. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://datapile.coffeecrew.org/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19717065-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  </body>
</html>
