<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Creating A Simple Plugin Mechanism In Java - The Datapile</title>




<meta name="description" content="     On This Page  ">




<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Datapile">
<meta property="og:title" content="Creating A Simple Plugin Mechanism In Java">


  <link rel="canonical" href="https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/">
  <meta property="og:url" content="https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/">



  <meta property="og:description" content="     On This Page  ">



  <meta name="twitter:site" content="@authsec">
  <meta name="twitter:title" content="Creating A Simple Plugin Mechanism In Java">
  <meta name="twitter:description" content="     On This Page  ">
  <meta name="twitter:url" content="https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2013-06-02T17:36:18+02:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Jens Frey",
      "url" : "https://datapile.coffeecrew.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://datapile.coffeecrew.org/feed.xml" type="application/atom+xml" rel="alternate" title="The Datapile Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://datapile.coffeecrew.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://datapile.coffeecrew.org/">The Datapile</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/year-archive/">Archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://mmistakes.github.io/minimal-mistakes/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/categories/">Categories archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/tags/">Tags</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/c0ding" itemprop="item"><span itemprop="name">C0ding</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/java" itemprop="item"><span itemprop="name">Java</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Creating A Simple Plugin Mechanism In Java</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  


  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://datapile.coffeecrew.org/images/me.png" class="author__avatar" alt="" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name"></h3>
    
      <p class="author__bio" itemprop="description">
        Developer. Musician.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Lörrach</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      
        <li>
          <a href="https://plus.google.com/+JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+
          </a>
        </li>
      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.youtube.com/user/../c/JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-youtube-square" aria-hidden="true"></i> YouTube
          </a>
        </li>
      

      
        <li>
          <a href="https://soundcloud.com/john-c-flow" itemprop="sameAs">
            <i class="fa fa-fw fa-soundcloud" aria-hidden="true"></i> Soundcloud
          </a>
        </li>
      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Creating A Simple Plugin Mechanism In Java">
    <meta itemprop="description" content="     On This Page  ">
    <meta itemprop="datePublished" content="June 02, 2013">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Creating A Simple Plugin Mechanism In Java
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-file-text"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#create-domain-objects" id="markdown-toc-create-domain-objects">Create Domain Objects</a></li>
  <li><a href="#service-loader" id="markdown-toc-service-loader">Service Loader</a>    <ul>
      <li><a href="#plugin-executor" id="markdown-toc-plugin-executor">Plugin Executor</a></li>
    </ul>
  </li>
  <li><a href="#netbeans-lookup" id="markdown-toc-netbeans-lookup">Netbeans Lookup</a>    <ul>
      <li><a href="#plugin-executor-1" id="markdown-toc-plugin-executor-1">Plugin Executor</a></li>
    </ul>
  </li>
  <li><a href="#comparison" id="markdown-toc-comparison">Comparison</a></li>
  <li><a href="#one-more-thing" id="markdown-toc-one-more-thing">One More Thing</a></li>
</ul>

  </nav>
</aside>

<p>Our goal is to create a simple plugin mechanism in Java. On top of
that we want our execution environment to be divided into three
distinct phases. These phases are named:</p>

<ol>
  <li>PRE_PROCESS</li>
  <li>PROCESS</li>
  <li>POST_PROCESS</li>
</ol>

<p>This will allow us to run certain plugins at specific phases during
program execution. So if a plugin is for example registered on the
<code class="highlighter-rouge">PRE_PROCESS</code> hook, we can - and must - guarantee that this plugin
will be executed before the <code class="highlighter-rouge">PROCESS</code> phase.</p>

<p>After we’ve laid out the basic requirements now, the question is: “How
do we implement that?”.</p>

<p>The first thing that probably comes to mind when talking about a
plugin mechanism is the standard <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">Java ServiceLoader</a> that was
officially opened with the JDK6 and has been in there since the JDK
1.3 days. Another mechanism that can be used to implement a system
like this is the Netbeans Lookup API.</p>

<p>After defining a basic interface for the plugins we want to create,
we’ll have a look at both mechanisms to see how they compare.</p>

<h2 id="create-domain-objects">Create Domain Objects</h2>

<p>Ok, so let’s start defining the actual <code class="highlighter-rouge">Plugin</code> interface so we have a
common hook to execute our plugins on.</p>

<p>We make the interface itself very easy and just define a process
method in which we’ll later have implementations append the actual
phase and class name to the <code class="highlighter-rouge">String</code> instance that was passed as a
parameter. We’ll return that <code class="highlighter-rouge">String</code> to the caller, so we can
subsequently use it and demonstrate very easily when and where the
plugin was executed.</p>

<p>The interface we want to implement looks like this:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

/**
 Simple plugin interface.
 &lt;p/&gt;
 @author Jens Frey
 */
public interface Plugin {

    /**
     Simple worker method that will append data on the processingToken.
     &lt;p/&gt;
     And another.
     &lt;p/&gt;
     @param processingToken Token where data should be appended during
                            processing.
     &lt;p/&gt;
     @return processingToken that has been worked on.
     */
    public String process(String processingToken);
}</pre></noscript>
<script src="https://gist.github.com/authsec/8b04fe00c4d26e312e03d7cd53cb0177.js"> </script>

<p>As a next step we define three interfaces that act as marker
interfaces so we can differentiate the lifecycle phase the plugin
should be run in by the name of the implemented interface. These
interfaces are defined as shown below.</p>

<p>For the <code class="highlighter-rouge">PRE_PROCESS</code> phase:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

/**
 Marker Interface to tell this is a plugin running in the PRE_PROCESS phase.
 */
public interface PreProcessable extends Plugin {
}</pre></noscript>
<script src="https://gist.github.com/authsec/0a1e0553781f91d5886cab052eeef33d.js"> </script>

<p>For the <code class="highlighter-rouge">PROCESS</code> phase:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

/**
 Marker Interface to tell this is a plugin running in the PROCESS phase.
 */
public interface Processable extends Plugin {
}</pre></noscript>
<script src="https://gist.github.com/authsec/3d2c8906a2460d1910600880fab14aaa.js"> </script>

<p>For the <code class="highlighter-rouge">POST_PROCESS</code> phase:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

/**
 Marker Interface to tell this is a plugin running in the POST_PROCESS phase.
 */
public interface PostProcessable extends Plugin {
}</pre></noscript>
<script src="https://gist.github.com/authsec/837448f42c8f960ed860f04e5c6326cd.js"> </script>

<p>Now that we’ve defined the interfaces we need some implementations
that actually do something. At first we implement a plugin that should
be run in the <code class="highlighter-rouge">PRE_PROCESS</code> phase. It looks like:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

public class PreProcessPlugin implements PreProcessable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PRE_PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/63910920ab2aa90db5e3b88da621464f.js"> </script>

<p>The following implementations are running on the main processing hook
<code class="highlighter-rouge">PROCESS</code> and look as follows:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

public class ProcessPlugin implements Processable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/337d2225b5ce3855197fa5f702b6e538.js"> </script>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

public class MoreProcessPlugin implements Processable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/f514db12dba1d354a16d5d28bfd75b9e.js"> </script>

<p>And finally some implementation for the <code class="highlighter-rouge">POST_PROCESS</code> hook:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

public class PostProcessPlugin implements PostProcessable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[POST_PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/21754b08fbbeb69b92d664536a08527c.js"> </script>

<p>Now that was quite a bit of work, wasn’t it? But you’ll be shortly
rewarded with a nice and pluggable system. Now all we need to be happy
is a piece of code that actually runs all of these plugins. Since this
code looks slightly different whether we use Java’s ServiceLoader
mechanism directly or the Netbeans <code class="highlighter-rouge">Lookup</code> all the bits ’n pieces
required to make this work are outlined in separate sections shown
below.</p>

<h2 id="service-loader">Service Loader</h2>

<p>So let’s first have a look at the ServiceLoader mechanism. To prepare
implementations of a specific interface for automatic lookup by the
ServiceLoader you need to create files in the <code class="highlighter-rouge">META-INF/services</code> of
your resulting JAR file. I will describe inclusion of that folder on a
Maven based project.</p>

<p>In order to get the <code class="highlighter-rouge">META-INF/services</code> folder into your maven output
structure you have to create a folder named <code class="highlighter-rouge">resources</code> under
<code class="highlighter-rouge">src/main</code>. Inside the created <code class="highlighter-rouge">resources</code> folder you must place the
folder <code class="highlighter-rouge">META-INF</code> and underneath that the folder <code class="highlighter-rouge">services</code> which
Maven will copy when you launch the build.</p>

<p>As initially mentioned you need to put files inside the <code class="highlighter-rouge">services</code>
folder. These files must be named after the interface you want the
automatic lookup mechanism to find implementations for.</p>

<p>The content of these files is the actual class name of every
implementation you want the ServiceLoader to find. If you have
multiple implementations of a interface you need to include every
implementation class name inside that file delimited by a new line.</p>

<p>In our case these three files we need to create must be named (please
ensure you choose the correct package name that prepends the interface
name):</p>

<ul>
  <li><code class="highlighter-rouge">org.coffeecrew.tutorials.simplepluginmechanism.PreProcessable</code></li>
  <li><code class="highlighter-rouge">org.coffeecrew.tutorials.simplepluginmechanism.Processable</code></li>
  <li><code class="highlighter-rouge">org.coffeecrew.tutorials.simplepluginmechanism.PostProcessable</code></li>
</ul>

<p>These files must be filled with the following content (please ensure
you choose the correct package name that prepends the implementation
class name).</p>

<noscript><pre>org.coffeecrew.tutorials.simplepluginmechanism.PreProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/2d6c542c115de1e08234c4e1640b17c8.js"> </script>

<noscript><pre>org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/d630c11cf335958baa79771b884a084b.js"> </script>

<noscript><pre>org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/18f99e3ed7d861fe18428cc2b7958a1b.js"> </script>

<p>Now we’ve hopefully prepared everything the ServiceLoader needs to do
it’s job. All that’s missing now is a simple program that executes our
plugin mechanism.</p>

<h3 id="plugin-executor">Plugin Executor</h3>

<p>A very simple implementation that will execute all plugins we have
written with the ServiceLoader mechanism is quickly written. To
guarantee the execution order of the plugins as we initially defined
we must implement the code as shown below.</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import java.util.ServiceLoader;

public class SimplePluginExecutorServiceLoader {

    public static void main(String[] args) {
        String processingToken = &quot;&quot;;

        final ServiceLoader&lt;PreProcessable&gt; preProcessables = ServiceLoader.load(PreProcessable.class);
        for (final PreProcessable preProcessable : preProcessables) {
            processingToken = preProcessable.process(processingToken);
        }

        final ServiceLoader&lt;Processable&gt; processables = ServiceLoader.load(Processable.class);
        for (final Processable processable : processables) {
            processingToken = processable.process(processingToken);
        }

        final ServiceLoader&lt;PostProcessable&gt; postProcessables = ServiceLoader.load(PostProcessable.class);
        for (final PostProcessable postProcessable : postProcessables) {
            processingToken = postProcessable.process(processingToken);
        }

        System.out.println(processingToken);

    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/e9a96a2ddc4ee5f8e35780a9a2258ab6.js"> </script>

<p>As you can see the code is a pretty straight forward
implementation. It runs through every implementation that is available
for a given interface type and runs the <code class="highlighter-rouge">process()</code> method on it.</p>

<p>If you did everything right you should now see some output similar to:</p>

<noscript><pre>[PRE_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PreProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin
[POST_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/54dfb999114c9f15b63faaa2d0b6c55d.js"> </script>

<p>As we can see from the output every phase was executed. Where we had
two plugins available, both were run as well. This fulfills our basic
requirements.</p>

<h2 id="netbeans-lookup">Netbeans Lookup</h2>

<p>By utilizing the Lookup library you can very easily achieve loose
coupling, as you can with the ServiceLoader described above. On top of
that you get some nice annotations and the ability to give your
service implementation a certain priority when it should be run.</p>

<p>Now let’s have a look at the <a href="http://bits.netbeans.org/dev/javadoc/org-openide-util-lookup/org/openide/util/lookup/doc-files/lookup-api.html">Netbeans Lookup API</a> and see what’s
the difference to the ServiceLoader.</p>

<p>Well, the obvious first difference is that you need to include a
additional library in your project. That library, which was initially
strongly coupled to the Netbeans platform itself, was over time
separated from the platform so it can be used in applications that are
not based on the Netbeans platform and is available as a separate
Maven dependency these days.</p>

<p>For the dependency resolution to work you need to include the Netbeans
repository in your <code class="highlighter-rouge">pom.xml</code> so you’re able to get a hold of the
library as this library is not available in one of the well know
central repositories as for example <a href="http://repo.maven.apache.org">The Central Repository</a>. There
is a <a href="https://netbeans.org/bugzilla/show_bug.cgi?id=202041">discussion</a> going on about this which may or may not lead to
a centrally available dependency in the future.</p>

<p>You can however reference the library by appending the following
information into your projects <code class="highlighter-rouge">pom.xml</code> file.</p>

<noscript><pre>&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;Netbeans Repository&lt;/id&gt;
        &lt;url&gt;http://bits.netbeans.org/maven2/&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.netbeans.api&lt;/groupId&gt;
        &lt;artifactId&gt;org-openide-util-lookup&lt;/artifactId&gt;
        &lt;version&gt;RELEASE73&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></noscript>
<script src="https://gist.github.com/authsec/98d2234229893c8070a811361142de97.js"> </script>

<p>Don’t forget to execute a build of your project, so maven can download
the newly added dependency for you.</p>

<p>If you’re still working on the initial project where we’ve used the
ServiceLoader mechanism please make sure you delete the <code class="highlighter-rouge">resources</code>
folder now, you don’t need it in conjunction with the Lookup API.</p>

<p>For the Lookup API to work you need to add annotations to your domain
objects. These annotations will create the files with the interface
name and fill their content with the class names that provide an
implementation for that interface.</p>

<p>This probably sounds more difficult than it actually is now, but it’s
actually a trivial thing to do. You simply need to add a little
<code class="highlighter-rouge">@ServiceProvider</code> annotation in front of your class name.</p>

<p>To make this as simple as possible I print the four classes again,
their content is the same as outlined in the <a href="#create-domain-objects">Create Domain
Objects</a> section, just with the added
annotation.</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import org.openide.util.lookup.ServiceProvider;

@ServiceProvider(service = PreProcessable.class)
public class PreProcessPlugin implements PreProcessable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PRE_PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/88602c7d6ff6e36c23cf47d1c748216f.js"> </script>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import org.openide.util.lookup.ServiceProvider;

@ServiceProvider(service = Processable.class, position = 10)
public class ProcessPlugin implements Processable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/b56bd447e7cf1752f6197aff52eefd5b.js"> </script>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import org.openide.util.lookup.ServiceProvider;

@ServiceProvider(service = Processable.class)
public class MoreProcessPlugin implements Processable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/44d1e5d412d5ab2fde9298323489925b.js"> </script>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import org.openide.util.lookup.ServiceProvider;

@ServiceProvider(service = PostProcessable.class)
public class PostProcessPlugin implements PostProcessable {

    @Override
    public String process(String processingToken) {
        return processingToken + &quot;[POST_PROCESS] &quot; + this.getClass().getName() + &quot;\n&quot;;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/aa004b0d10d4a1a63f39c299d066aa91.js"> </script>

<p>Now that we’ve changed our domain object to utilize the annotations
provided by the Lookup API we need an executor method to run our
plugins in. All that changes compared to the ServiceLoader approach is
the way you look up the implementations. It’s just a different API
call.</p>

<h3 id="plugin-executor-1">Plugin Executor</h3>

<p>Again we’ll show a very simple implementation that will execute all
plugins we have written.</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import java.util.Collection;
import org.openide.util.Lookup;

public class SimplePluginExecutorLookupAPI {

    public static void main(String[] args) {
        String processingToken = &quot;&quot;;

        final Collection&lt;? extends PreProcessable&gt; preProcessables = Lookup.getDefault().lookupAll(PreProcessable.class);
        for (final PreProcessable preProcessable : preProcessables) {
            processingToken = preProcessable.process(processingToken);
        }

        final Collection&lt;? extends Processable&gt; processables = Lookup.getDefault().lookupAll(Processable.class);
        for (final Processable processable : processables) {
            processingToken = processable.process(processingToken);
        }

        final Collection&lt;? extends PostProcessable&gt; postProcessables = Lookup.getDefault().lookupAll(PostProcessable.class);
        for (final PostProcessable postProcessable : postProcessables) {
            processingToken = postProcessable.process(processingToken);
        }

        System.out.println(processingToken);

    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/98deea0ad5626ce0a5c745b193065af8.js"> </script>

<p>As you can see this code is basically the same as with the
ServiceLoader approach. It runs through every implementation that is
available for a given interface type and runs the <code class="highlighter-rouge">process()</code> method
on it.</p>

<p>However, you might notice that the output slightly changed. With the
Lookup API the <code class="highlighter-rouge">MoreProcessPlugin</code> is executed before the
<code class="highlighter-rouge">ProcessPlugin</code>. This is something we may not want in case we care
about the order in which these plugins need to run when they are
executed within the same phase.</p>

<noscript><pre>[PRE_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PreProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin
[POST_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/fbdfab577d8dd5d7ef99457198875339.js"> </script>

<noscript><pre>[PRE_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PreProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
[POST_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/2bc00886294edf3e10a050b5b4d699b2.js"> </script>

<p>Luckily there s a mechanism which allows you to control exactly that
behavior. And it’s built in right into the Lookup API. The
<code class="highlighter-rouge">@ServiceProvider</code> annotation let’s you set a position attribute. This
position attribute defines when this implementation should be run, if
another implementation is also available. The higher the position
number is, the earlier the implementation is run.</p>

<p>Since the default position value is 0 it is sufficient to assign a
value only to the <code class="highlighter-rouge">ProcessPlugin</code> implementation. Changing the
<code class="highlighter-rouge">@ServiceProvider</code> line in the <code class="highlighter-rouge">ProcessPlugin</code> to</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@ServiceProvider</span><span class="o">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">Processable</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">10</span><span class="o">)</span>
</code></pre>
</div>

<p>Will result in the following output which reflects the actual
processing order of the ServiceLoader example.</p>

<h2 id="comparison">Comparison</h2>

<p>As you could see the Lookup API simplifies work by generating the
files you’d normally have to create in <code class="highlighter-rouge">META-INF/services</code>
manually. By the generative approach and the position attribute you
can also guarantee a specific execution order without the hassle to
manually reorder the content of the files in <code class="highlighter-rouge">META-INF/services</code>.</p>

<p>The Lookup API offers much more advanced features aside from the ones
that were mentioned here, like for example Lookup templates that allow
you to query information on an object without instantiating it or
listening to changes in a Lookup. You could also lookup different
implementations for a service based on it’s MIME type.</p>

<h2 id="one-more-thing">One More Thing</h2>

<p>Now I have actually one more thing I want to share with you. This
approach works for both previously introduced plugin mechanisms, but
will be included in the Lookup API example only.</p>

<p>It allows you to add or remove processing phases without having to
rewrite all your processing code. This can simply be achieved by
assigning the interface classes to an enumeration type. So let’s first
implement the enumeration type that ties together the processing phase
and the interface assigned to it.</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

public enum Phase {

    PRE_PROCESS(PreProcessable.class),
    PROCESS(Processable.class),
    POST_PROCESS(PostProcessable.class);
    private final Class&lt;? extends Plugin&gt; plugin;

    private Phase(Class&lt;? extends Plugin&gt; plugin) {
        this.plugin = plugin;
    }

    public Class&lt;? extends Plugin&gt; getPhaseInterface() {
        return plugin;
    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/f373641102bd33f291e6142cdc3cc9f5.js"> </script>

<p>As you can see the implementation is fairly trivial, yet
effective. Now all we need is an adapted executor for this to work. An
implementation that utilizes the new idea looks as follows:</p>

<noscript><pre>package org.coffeecrew.tutorials.simplepluginmechanism;

import java.util.Collection;
import org.openide.util.Lookup;

public class SimplePhaseExecutor {

    public static void main(String[] args) {
        String processingToken = &quot;&quot;;

        for (final Phase p : Phase.values()) {
            final Collection&lt;? extends Plugin&gt; processables = Lookup.getDefault().lookupAll(p.getPhaseInterface());
            for (final Plugin plugin : processables) {
                processingToken = plugin.process(processingToken);
            }
        }
        System.out.println(processingToken);

    }
}</pre></noscript>
<script src="https://gist.github.com/authsec/e22413482d704181efb956d51bfb8ecc.js"> </script>

<p>Execution of the above code will result in the following output:</p>

<noscript><pre>[PRE_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PreProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin
[POST_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/022cd064f176221146dd106445f8cbe1.js"> </script>

<p>Which is what we have expected it to do. The cool part however is - if
you need to change the execution order of the phases, add a new phase,
or delete a phase - you do not need to change the executor code but
only the order or number of elements in the <code class="highlighter-rouge">Phase</code> enumeration.</p>

<p>So should you decide to no longer include the <code class="highlighter-rouge">PRE_PROCESS</code> phase
anymore you just need to remove the phase from the enumeration type,
re-run the example aaaand:</p>

<noscript><pre>[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.ProcessPlugin
[PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.MoreProcessPlugin
[POST_PROCESS] org.coffeecrew.tutorials.simplepluginmechanism.PostProcessPlugin</pre></noscript>
<script src="https://gist.github.com/authsec/c603422c7d60a6f07b7ab37d48c6fc91.js"> </script>

<p>There you go, no more annoying <code class="highlighter-rouge">PRE_PROCESSING</code>, just as expected :)</p>

<p>If you like you can clone the two projects from Github:</p>

<ul>
  <li><a href="https://github.com/authsec/examples/tree/master/java/SimplePluginMechanismServiceLoader">ServiceLoader Version</a></li>
  <li><a href="https://github.com/authsec/examples/tree/master/java/SimplePluginMechanismLookupAPI">LookupAPI Version</a></li>
</ul>

<p>Hope you enjoyed the post! Leave comments, like ’n share!</p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-06-02T17:36:18+02:00">June 02, 2013</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=authsec&text=Creating A Simple Plugin Mechanism In Java https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://datapile.coffeecrew.org/c0ding/java/creating-a-simple-plugin-mechanism-in-java/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://datapile.coffeecrew.org/music/covers/grenade-cover-version/" class="pagination--pager" title="Grenade - Cover Version
">Previous</a>
    
    
      <a href="https://datapile.coffeecrew.org/music/pro-tools/shortcuts/pro-tools-playlists/" class="pagination--pager" title="Pro Tools - Playlists
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/authsec"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/authsec"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://datapile.coffeecrew.org/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Jens Frey. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://datapile.coffeecrew.org/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19717065-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  </body>
</html>
