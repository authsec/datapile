<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Back To QNAP - The Datapile</title>




<meta name="description" content="How to backup a remote folder to your QNAP storage">




<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Datapile">
<meta property="og:title" content="Back To QNAP">


  <link rel="canonical" href="https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/">
  <meta property="og:url" content="https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/">



  <meta property="og:description" content="How to backup a remote folder to your QNAP storage">



  <meta name="twitter:site" content="@authsec">
  <meta name="twitter:title" content="Back To QNAP">
  <meta name="twitter:description" content="How to backup a remote folder to your QNAP storage">
  <meta name="twitter:url" content="https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  



  <meta property="og:image" content="https://datapile.coffeecrew.org/images/storage.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-06-15T23:36:12+02:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Jens Frey",
      "url" : "https://datapile.coffeecrew.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://datapile.coffeecrew.org/feed.xml" type="application/atom+xml" rel="alternate" title="The Datapile Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://datapile.coffeecrew.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://datapile.coffeecrew.org/">The Datapile</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/year-archive/">Archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://mmistakes.github.io/minimal-mistakes/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/categories/">Categories archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://datapile.coffeecrew.org/tags/">Tags</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    
  







<div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://datapile.coffeecrew.org/images/storage.png');">
  
    <div class="wrapper">
      <h1 class="page__title" itemprop="headline">
        
          Back To QNAP

        
      </h1>
      
        <p class="page__lead">How to backup a remote folder to your QNAP storage
</p>
      
      
      
    </div>
  
  
</div>



  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/c0ding" itemprop="item"><span itemprop="name">C0ding</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://datapile.coffeecrew.org/scripting" itemprop="item"><span itemprop="name">Scripting</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Back To QNAP</li>
      
    
  </ol>
</nav>
  


<div id="main" role="main">
  


  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://datapile.coffeecrew.org/images/me.png" class="author__avatar" alt="" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name"></h3>
    
      <p class="author__bio" itemprop="description">
        Developer. Musician.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Lörrach</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      
        <li>
          <a href="https://plus.google.com/+JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+
          </a>
        </li>
      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/authsec" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.youtube.com/user/../c/JensFrey" itemprop="sameAs">
            <i class="fa fa-fw fa-youtube-square" aria-hidden="true"></i> YouTube
          </a>
        </li>
      

      
        <li>
          <a href="https://soundcloud.com/john-c-flow" itemprop="sameAs">
            <i class="fa fa-fw fa-soundcloud" aria-hidden="true"></i> Soundcloud
          </a>
        </li>
      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Back To QNAP">
    <meta itemprop="description" content="How to backup a remote folder to your QNAP storage">
    <meta itemprop="datePublished" content="June 15, 2016">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        <p>Sometimes you may want to backup/synchronize data from a remote server to your
local QNAP server. This can be done fairly easily and efficiently
using the already installed <code class="highlighter-rouge">rsync</code> command.</p>

<p class="notice--info"><strong>Note:</strong> You need to have set up a passwordless SSH login from your
QNAP to your remote host for the below script to work.</p>

<p>In addition the script below will send an eMail once it finishes
it’s run. To get the script going on your machine, simply adapt the
variables to point to your local directories and supply a valid eMail
address (can be the same for FROM and TO).</p>

<p>As any operating system upgrade will otherwise delete your backup
script you need to place it onto the share disk itself, as this will
prevent the script of being deleted during an upgrade operation (I suggest
stuffing it into a Gist on Github as well <img class="emoji" title=":wink:" alt=":wink:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png" height="20" width="20" align="absmiddle">).</p>

<p>I suggest putting the script in the following location if you have set
up a RAID 5 array (the location may be slightly different for you setup)
<code class="highlighter-rouge">/share/MD0_DATA</code>.</p>

<noscript><pre>#!/bin/sh

# Script to periodically synchronize a remote directory with your
# local QNAP storage.

# Source folders/user on remote machine
BACKUP_SOURCE_USER="backup-user"
BACKUP_SOURCE_HOST="backuphost.example.com"
BACKUP_SOURCE_FOLDER="/backup/subdir"

# Directory to save the remote backup locally
BACKUP_SINK_FOLDER="/share/MD0_DATA/Qmultimedia/backup-dir"
# For grepping the available space
BACKUP_SHARE_MOUNT_POINT="/share/MD0_DATA"

SUBJ_PREFIX="[RSYNC BACKUP]"
SUBJECT_FAIL="${SUBJ_PREFIX} Synchronization unsuccessful!"
SUBJECT_SUCCESS="${SUBJ_PREFIX} Synchronization successful!"

MAIL_TO="hansi@example.com"
MAIL_FROM="hansi-machine@example.com"

MSG_CONTENT_FILE="/tmp/email_body.txt"
RSYNC_CONTENT_FILE="/tmp/rsyncContent.txt"

# Sends a mail message
# $1 = subject
# $2 = to
# $3 = from
# $4 = msg
send_mail()
{
   local tmpfile="/tmp/sendmail.tmp"
   /bin/echo -e "Subject: $1\r" &gt; "$tmpfile"
   /bin/echo -e "To: $2\r" &gt;&gt; "$tmpfile"
   /bin/echo -e "From: $3\r" &gt;&gt; "$tmpfile"
   /bin/echo -e "\r" &gt;&gt; "$tmpfile"
   if [ -f "$4" ]; then
      cat "$4" &gt;&gt; "$tmpfile"
      /bin/echo -e "\r\n" &gt;&gt; "$tmpfile"
   else
      /bin/echo -e "$4\r\n" &gt;&gt; "$tmpfile"
   fi
   /usr/sbin/sendmail -t &lt; "$tmpfile"
   rm $tmpfile
}

/bin/echo -e "Backup started at: $(date)\n" &gt; ${MSG_CONTENT_FILE}
/bin/echo "Space available on backup disk (before backup)" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo "$(df -h | head -n1)" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo "$(df -h | grep ${BACKUP_SHARE_MOUNT_POINT})" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo -e "\n" &gt;&gt; ${MSG_CONTENT_FILE}

/bin/echo -e "The following output was produced by the rsync command:\n" &gt; ${RSYNC_CONTENT_FILE}
/usr/bin/rsync -azhv ${BACKUP_SOURCE_USER}@${BACKUP_SOURCE_HOST}:${BACKUP_SOURCE_FOLDER} ${BACKUP_SINK_FOLDER} &gt;&gt; ${RSYNC_CONTENT_FILE}

if [ $? -eq 0 ]
then
  SUBJECT=${SUBJECT_SUCCESS}
else
  SUBJECT=${SUBJECT_FAIL}
fi

/bin/echo -e "Backup ended at: $(date)\n" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo "Space available on backup disk (after backup)" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo "$(df -h | head -n1)" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo "$(df -h | grep ${BACKUP_SHARE_MOUNT_POINT})" &gt;&gt; ${MSG_CONTENT_FILE}
/bin/echo -e "\n" &gt;&gt; ${MSG_CONTENT_FILE}

/bin/cat ${RSYNC_CONTENT_FILE} &gt;&gt; ${MSG_CONTENT_FILE}

send_mail "${SUBJECT}" "${MAIL_TO}" "${MAIL_FROM}" ${MSG_CONTENT_FILE}
</pre></noscript>
<script src="https://gist.github.com/authsec/42b3c5099e1cc45bc761c8bb6366ede8.js"> </script>

<h2 id="executing-a-daily-backup">Executing A Daily backup</h2>

<p>Once the script is in it’s place you need to configure a cron job
so it will be executed let’s say once a day at 5 AM. To do so simply
type <code class="highlighter-rouge">crontab -e</code> into your terminal as admin user and add a line like
this at the end of the file.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>0 5 * * * /share/MD0_DATA/backupRemoteDirToQnap.sh
</code></pre>
</div>

<p>There you have it, nice and shiny backup.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-06-15T23:36:12+02:00">June 15, 2016</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=authsec&amp;text=Back%20To%20QNAP%20https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://datapile.coffeecrew.org/c0ding/scripting/backup-remote-rolder-to-qnap/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://datapile.coffeecrew.org/links/SSL-TLS-Encryption-With-Apache/" class="pagination--pager" title="SSL/TLS Strong Encryption: How-To
">Previous</a>
    
    
      <a href="https://datapile.coffeecrew.org/c0ding/java/programmatically-start-a-faces-flow/" class="pagination--pager" title="Programmatically Start A JSF Flow
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://www.knitelius.com/2016/05/18/cdi-passivation-uncovered/">CDI Passivation (Serialization) Uncovered
</a> <a href="https://datapile.coffeecrew.org/links/CDI-passivation/" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">If an ApplicationScoped bean is marked transient, the client proxy will not be serialized nor re-injected during deserialization and remains null.
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://lifehacker.com/prevent-windows-10-from-automatically-restarting-your-p-1723647582">Windows 10 - Manage device updates after restart
</a> <a href="https://datapile.coffeecrew.org/links/Manage-device-restart-after-update/" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">How to delay Windows 10 updates.
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://datapile.coffeecrew.org/services/consul/start-consul-docker-image/" rel="permalink">How To Start A Consul Docker Image
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">If you quickly have to start a consul docker image
you can use the following command.

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://datapile.coffeecrew.org/c0ding/maven/Upload-Maven-Artifacts-Into-Nexus-3/" rel="permalink">Upload Maven Artifacts Into Nexus 3
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Sometimes you need to upload an artifact into Nexus. With Nexus 2 this was very
easy if you had filesystem access or access to the Web UI. In Nexus 3 you are...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/authsec"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/authsec"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://datapile.coffeecrew.org/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2018 Jens Frey. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://datapile.coffeecrew.org/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19717065-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  </body>
</html>
