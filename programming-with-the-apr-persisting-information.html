<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://datapile.coffeecrew.org/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://datapile.coffeecrew.org/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Jens Frey" />

        <meta name="description" content="This article will show you how to store information in the database that comes with the Apache Portable Runtime (APR).
" />
        <meta name="twitter:creator" content="@authsec">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="APR, Apache, C, Programming, " />

<meta property="og:title" content="Programming with the APR - Persisting information "/>
<meta property="og:url" content="https://datapile.coffeecrew.org/programming-with-the-apr-persisting-information" />
<meta property="og:description" content="This article will show you how to store information in the database that comes with the Apache Portable Runtime (APR)." />
<meta property="og:site_name" content="Datapile" />
<meta property="og:article:author" content="Jens Frey" />
<meta property="og:article:published_time" content="2010-11-01T11:00:34+01:00" />
<meta name="twitter:title" content="Programming with the APR - Persisting information ">
<meta name="twitter:description" content="This article will show you how to store information in the database that comes with the Apache Portable Runtime (APR).">

        <title>Programming with the APR - Persisting information  · Datapile
</title>
        <link rel="shortcut icon" href="https://datapile.coffeecrew.org/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://datapile.coffeecrew.org/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://datapile.coffeecrew.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Datapile - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-19717065-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://datapile.coffeecrew.org/"><span class=site-name>Datapile</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://datapile.coffeecrew.org
                                    >Home</a>
                                </li>
                                <li ><a href="https://datapile.coffeecrew.org/categories">Categories</a></li>
                                <li ><a href="https://datapile.coffeecrew.org/tags">Tags</a></li>
                                <li ><a href="https://datapile.coffeecrew.org/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://datapile.coffeecrew.org/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://datapile.coffeecrew.org/programming-with-the-apr-persisting-information">
                Programming with the <span class="caps">APR</span> - Persisting&nbsp;information
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>This article will show you how to store information in the database that comes with the Apache Portable Runtime (<span class="caps">APR</span>). Basically a simple struct data type is persisted into that database. You can download the code <a class="reference external" href="https://raw.githubusercontent.com/authsec/examples/master/c/aprWithSdbm.c">here</a>&nbsp;.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The program supplied should actually use <code>apr_app_initialize(&amp;argc, &amp;argv, NULL);</code> since <code>apr_initialize()</code> is intended for library use&nbsp;only.</p>
</div>
<div class="section" id="function-description">
<h2>Function&nbsp;description</h2>
<p>In order to store the information in that database you probably might want to create some functions to better break down work into smaller parts. Since the database mechanism requires you to have information available as an <code>apr_datum_t</code> type, you probably want to introduce some helper functions which exactly deal with that issue. Converting your normal data types into a <code>apr_datum_t</code>.</p>
</div>
<div class="section" id="helper-functions">
<h2>Helper&nbsp;functions</h2>
<p>My helper functions which convert a normal <code>char*</code> or an <code>apr_time_t</code> into the required <code>apr_datum_t</code> are&nbsp;called:</p>
<ul class="simple">
<li><code>string2datum(apr_pool_t *p, char *toDatum)</code></li>
<li><code>time2datum(apr_pool_t *p, apr_time_t *toDump)</code></li>
<li><code>checkError(apr_status_t rv)</code></li>
</ul>
<p>You eventually might ask what the pool is for. Since the <code>apr_datum_t</code> type holds a <code>char *</code> and the according size of that pointer, we have to allocate space somewhere. That space is allocated on the pool you give that function. So make sure your pools lifetime is big enough so you can retrieve the value the function built for you. The <code>checkError</code> function is used for checking the return value that the various database access functions might return. This is basically to avoid lots of&nbsp;typing.</p>
<div class="section" id="worker-functions">
<h3>Worker&nbsp;functions</h3>
<p>Now you need a few functions that do the actual work for you. APRs abstraction is not bad, but cannot handle automatic key generation in this case. <span class="caps">APR</span> uses a key for every saved <code>apr_datum_t</code>. We want to store a more complex datatype to disc, so we need to have a key for every field of our structure when we do want to save&nbsp;it.</p>
<p>The basic idea is to flatten the structure when storing it. So we are writing every field of the structure linearly to disc. When we read the data from disc we do that in the same order as we have written it. This mechanism should restore the original data structure we were working with. The following functions persist a single datum, a whole struct and the read function reads back the whole struct from the&nbsp;disc.</p>
<ul class="simple">
<li><code>apr_status_t persistUserRecord(unsigned int *key, apr_dbm_t *database, struct userRecord *user)</code></li>
<li><code>apr_status_t persistDatum(unsigned int *key, apr_dbm_t *database, apr_datum_t *toDump)</code></li>
<li><code>struct userRecord *readUserRecord(apr_pool_t *resultPool, apr_dbm_t *db, apr_datum_t *lastReadKey)</code></li>
</ul>
<p>These functions are not implemented, but might give you an idea of how the <span class="caps">API</span> can look like if you want to serialize a whole bunch of&nbsp;data.</p>
<ul class="simple">
<li><code>void persistUserRecords(apr_table_t *userRecords)</code></li>
<li><code>apr_table_t *readUserRecords(apr_pool_t *resultPool)</code></li>
</ul>
<p>You surely are interested in how the actual code looks by now. Now i will no longer deprive you from&nbsp;that.</p>
<pre class="code c literal-block">
<span class="cp">#include</span> <span class="cpf">&lt;apr.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;apu.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;apr_dbm.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;apr_time.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;apr_strings.h&gt;</span><span class="cp">
#define APR_WANT_STDIO
#define APR_WANT_MEMFUNC
#include</span> <span class="cpf">&lt;apr_want.h&gt;</span><span class="cp">
</span>

<span class="cp">#define DBM_TYPE &quot;SDBM&quot;
#define DEBUG
#ifdef DEBUG
#define PDEBUG(message, arguments) printf(&quot;[DEBUG] &quot; message &quot;\n&quot;, arguments)
#define PDEBUG_NA(message) printf(&quot;[DEBUG] &quot; message &quot;\n&quot;)
#else
#define PDEBUG(message, arguments) </span><span class="cm">/* empty */</span><span class="cp">
#define PDEBUG_NA(message) </span><span class="cm">/* empty */</span><span class="cp">
#endif
</span>
<span class="cm">/* Compile with
 * $&gt; export APR_LIBS=&quot;`apr-1-config --cflags --cppflags --includes --ldflags --link-ld --libs`&quot;
 * $&gt; export APU_LIBS=&quot;`apu-1-config --includes --ldflags --link-ld --libs`&quot;
 * $&gt; gcc $APR_LIBS $APU_LIBS aprWithSdbm.c -o aprWithSdbm
 */</span>

<span class="k">struct</span> <span class="nc">userRecord</span>
<span class="p">{</span>
  <span class="n">apr_time_t</span> <span class="n">creationDate</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span><span class="p">);</span>
<span class="cm">/* since apr_datum_t* results in a nested structure
 * this allocates the memory on the nested
 * char* onto the given pool.
 */</span>
<span class="n">apr_datum_t</span><span class="o">*</span> <span class="nf">string2datum</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
                          <span class="kt">char</span> <span class="o">*</span><span class="n">toDatum</span><span class="p">);</span>
<span class="n">apr_datum_t</span><span class="o">*</span> <span class="nf">time2datum</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
                        <span class="n">apr_time_t</span> <span class="o">*</span><span class="n">toDatum</span><span class="p">);</span>

<span class="n">apr_status_t</span> <span class="nf">persistDatum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span>
                          <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span>
                          <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">toDump</span><span class="p">);</span>

<span class="n">apr_status_t</span> <span class="nf">persistUserRecord</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span>
                               <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span>
                               <span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">persistUserRecords</span><span class="p">(</span><span class="n">apr_table_t</span> <span class="o">*</span><span class="n">userRecords</span><span class="p">);</span>
<span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">readUserRecord</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">resultPool</span><span class="p">,</span>
                                  <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span>
                                  <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">lastReadKey</span><span class="p">);</span>
<span class="n">apr_table_t</span> <span class="o">*</span><span class="nf">readUserRecords</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">resultPool</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">checkError</span><span class="p">(</span><span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">);</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>

  <span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="o">*</span><span class="n">user2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">userReadBack</span><span class="p">,</span> <span class="o">*</span><span class="n">userReadBack2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">mainPool</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">db</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">apr_datum_t</span> <span class="n">readKey</span><span class="p">;</span>
  <span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">;</span>


  <span class="cm">/* Always init at program start */</span>
  <span class="n">apr_initialize</span><span class="p">();</span>

  <span class="cm">/* Register cleanup */</span>
  <span class="n">atexit</span><span class="p">(</span><span class="n">apr_terminate</span><span class="p">);</span>

  <span class="cm">/* create our main memory pool,
   * which will be valid during the programs lifetime
   */</span>
  <span class="n">apr_pool_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mainPool</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="cm">/* Allocate memory for a user on the main pool */</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="nc">userRecord</span><span class="p">));</span>

  <span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span> <span class="o">=</span> <span class="n">apr_pstrdup</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="s">&quot;Jens Frey&quot;</span><span class="p">);</span>
  <span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span> <span class="o">=</span> <span class="n">apr_pstrdup</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="s">&quot;secret&quot;</span><span class="p">);</span>
  <span class="n">user</span><span class="o">-&gt;</span><span class="n">creationDate</span> <span class="o">=</span> <span class="n">apr_time_now</span><span class="p">();</span>

  <span class="n">user2</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="nc">userRecord</span><span class="p">));</span>

  <span class="n">user2</span><span class="o">-&gt;</span><span class="n">username</span> <span class="o">=</span> <span class="n">apr_pstrdup</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="s">&quot;Master Frey&quot;</span><span class="p">);</span>
  <span class="n">user2</span><span class="o">-&gt;</span><span class="n">password</span> <span class="o">=</span> <span class="n">apr_pstrdup</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="s">&quot;more secret password&quot;</span><span class="p">);</span>
  <span class="n">user2</span><span class="o">-&gt;</span><span class="n">creationDate</span> <span class="o">=</span> <span class="n">apr_time_now</span><span class="p">();</span>

  <span class="n">print</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">user2</span><span class="p">);</span>
  <span class="n">apr_dbm_open_ex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">db</span><span class="p">,</span> <span class="n">DBM_TYPE</span><span class="p">,</span> <span class="s">&quot;/tmp/testDatabase&quot;</span><span class="p">,</span> <span class="n">APR_DBM_RWTRUNC</span><span class="p">,</span>
               <span class="n">APR_FPROT_OS_DEFAULT</span><span class="p">,</span> <span class="n">mainPool</span><span class="p">);</span>

  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;Counter value: %u&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
  <span class="n">persistUserRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">counter</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
  <span class="n">persistUserRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">counter</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user2</span><span class="p">);</span>
  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;Counter value: %u&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>

  <span class="c1">//Query the first Key, the rest are subsequently queried alone
</span>  <span class="n">rv</span> <span class="o">=</span>  <span class="n">apr_dbm_firstkey</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">readKey</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="n">userReadBack</span> <span class="o">=</span> <span class="n">readUserRecord</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">readKey</span><span class="p">);</span>
  <span class="n">userReadBack2</span> <span class="o">=</span> <span class="n">readUserRecord</span><span class="p">(</span><span class="n">mainPool</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">readKey</span><span class="p">);</span>

  <span class="n">print</span><span class="p">(</span><span class="n">userReadBack</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">userReadBack2</span><span class="p">);</span>

  <span class="n">apr_dbm_close</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
  <span class="n">apr_pool_destroy</span><span class="p">(</span><span class="n">mainPool</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">checkError</span><span class="p">(</span><span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="o">!=</span> <span class="n">APR_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;An error happened while operating with the database (code %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rv</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">readUserRecord</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span> <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">lastReadKey</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_datum_t</span> <span class="n">tmp</span><span class="p">;</span>
  <span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">;</span>

  <span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="nc">userRecord</span><span class="p">));</span>

  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;enter readUserRecord()&quot;</span><span class="p">);</span>

  <span class="cm">/* Read username */</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_fetch</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">*</span><span class="n">lastReadKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span> <span class="o">=</span> <span class="n">apr_pstrndup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">dptr</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">dsize</span><span class="p">);</span>

  <span class="cm">/* Advance to next key and read password */</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_nextkey</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">lastReadKey</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_fetch</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">*</span><span class="n">lastReadKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span> <span class="o">=</span> <span class="n">apr_pstrndup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">dptr</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">dsize</span><span class="p">);</span>

  <span class="cm">/* Timestamp */</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_nextkey</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">lastReadKey</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_fetch</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">*</span><span class="n">lastReadKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>
  <span class="cm">/* Memcpy that, that part of the structure is already alloced */</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">creationDate</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">dptr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">apr_time_t</span><span class="p">));</span>


  <span class="cm">/* Set the key to the next element, so a subsequent call will
     be correct again
  */</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_nextkey</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">lastReadKey</span><span class="p">);</span>
  <span class="n">checkError</span><span class="p">(</span><span class="n">rv</span><span class="p">);</span>

  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;leave readUserRecord()&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">user</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Converts an apr_time_t into a
 * persistable apr_datum_t
 */</span>
<span class="n">apr_datum_t</span><span class="o">*</span> <span class="n">time2datum</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">apr_time_t</span> <span class="o">*</span><span class="n">toDatum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">dt</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">apr_datum_t</span><span class="p">));</span>

  <span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">apr_time_t</span><span class="p">);</span>
  <span class="n">dt</span><span class="o">-&gt;</span><span class="n">dptr</span> <span class="o">=</span> <span class="n">apr_pmemdup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">toDatum</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
  <span class="n">dt</span><span class="o">-&gt;</span><span class="n">dsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*
 * Converts the given char* into a apr_datum_t with lengths set correctly
 * depending on the database type. The memory required for the string
 * to be held is saved in the given memory pool.
 *
 */</span>
<span class="n">apr_datum_t</span><span class="o">*</span> <span class="n">string2datum</span><span class="p">(</span><span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">toDatum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">dt</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">apr_datum_t</span><span class="p">));</span>

  <span class="n">dt</span><span class="o">-&gt;</span><span class="n">dptr</span> <span class="o">=</span> <span class="n">apr_pstrdup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">toDatum</span><span class="p">);</span>

<span class="cp">#ifndef NETSCAPE_DBM_COMPAT
</span>  <span class="n">dt</span><span class="o">-&gt;</span><span class="n">dsize</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">dt</span><span class="o">-&gt;</span><span class="n">dptr</span><span class="p">);</span>
<span class="cp">#else
</span>  <span class="n">dt</span><span class="o">-&gt;</span><span class="n">dsize</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">dt</span><span class="o">-&gt;</span><span class="n">dptr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif
</span>
    <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* This function persists the whole struct userRecord
 * into the SDBM database. You have to check if this implementation
 * is still correct if you change your struct.
 *
 * There should however be no problem if you are just adding transient
 * parameters that should not be persisted at all.
 */</span>
<span class="n">apr_status_t</span> <span class="n">persistUserRecord</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">;</span>
  <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">dumpKey</span><span class="p">;</span>
  <span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;enter persistUserRecord()&quot;</span><span class="p">);</span>

  <span class="n">apr_pool_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="cm">/* Now fill in every field of the record */</span>
  <span class="n">dumpKey</span> <span class="o">=</span> <span class="n">string2datum</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">);</span>
  <span class="n">persistDatum</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">dumpKey</span><span class="p">);</span>

  <span class="n">dumpKey</span> <span class="o">=</span> <span class="n">string2datum</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">);</span>
  <span class="n">persistDatum</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">dumpKey</span><span class="p">);</span>

  <span class="n">dumpKey</span> <span class="o">=</span> <span class="n">time2datum</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">creationDate</span><span class="p">);</span>
  <span class="n">persistDatum</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">dumpKey</span><span class="p">);</span>

  <span class="n">apr_pool_destroy</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;leave persistUserRecord()&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*
  Assumes an open database.
 */</span>
<span class="n">apr_status_t</span> <span class="n">persistDatum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="n">apr_dbm_t</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span> <span class="n">apr_datum_t</span> <span class="o">*</span><span class="n">toDump</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_status_t</span> <span class="n">rv</span><span class="p">;</span>
  <span class="n">apr_datum_t</span> <span class="n">datumKey</span><span class="p">;</span>
  <span class="n">datumKey</span><span class="p">.</span><span class="n">dptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">key</span><span class="p">;</span>
  <span class="n">datumKey</span><span class="p">.</span><span class="n">dsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>



  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;enter persistDatum()&quot;</span><span class="p">);</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">apr_dbm_store</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">datumKey</span><span class="p">,</span> <span class="o">*</span><span class="n">toDump</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="o">!=</span> <span class="n">APR_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error saving datum in database (returned %d)&quot;</span><span class="p">,</span> <span class="n">rv</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">//Increment count for every written datum
</span>  <span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;Key is %u&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
  <span class="n">PDEBUG_NA</span><span class="p">(</span><span class="s">&quot;leave persistDatum()&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">struct</span> <span class="nc">userRecord</span> <span class="o">*</span><span class="n">user</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">apr_pool_t</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">timeReadable</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">apr_pool_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">timeReadable</span> <span class="o">=</span> <span class="n">apr_palloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">APR_RFC822_DATE_LEN</span><span class="p">);</span>
  <span class="n">apr_rfc822_date</span><span class="p">(</span><span class="n">timeReadable</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">creationDate</span><span class="p">);</span>

  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;Username: %s&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">);</span>
  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;Password: %s&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">);</span>
  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;CreationDate (long): %&quot;</span> <span class="n">APR_TIME_T_FMT</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">creationDate</span><span class="p">);</span>
  <span class="n">PDEBUG</span><span class="p">(</span><span class="s">&quot;CreationDate (read): %s&quot;</span><span class="p">,</span> <span class="n">timeReadable</span><span class="p">);</span>

  <span class="n">apr_pool_destroy</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<p>Hope you enjoyed&nbsp;it.</p>
</div>
</div>



             
 
                <p id="post-share-links">
    Like this post? Share on:
      <a href="https://twitter.com/intent/tweet?text=Programming%20with%20the%20APR%20-%20Persisting%C2%A0information&url=https%3A//datapile.coffeecrew.org/programming-with-the-apr-persisting-information&via=authsec&hashtags=apr,apache,c" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 ❄       <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//datapile.coffeecrew.org/programming-with-the-apr-persisting-information" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
 ❄       <a href="mailto:?subject=Programming%20with%20the%20APR%20-%20Persisting%C2%A0information&amp;body=https%3A//datapile.coffeecrew.org/programming-with-the-apr-persisting-information" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>

                <hr />
    <div class="author-blurb">
        <a href="https://www.coffeecrew.org/" target="_blank" rel="nofollow noopener noreferrer">
            <img src=https://avatars3.githubusercontent.com/u/7973409?s=400&u=071356b002dc73eed0cf5ff16474df64edd3943c&v=4 alt="Jens Frey Avatar" title="Jens Frey">
            <span class="author-name">Jens Frey</span>
        </a>
        is the creator of the datapile blog.
    </div>

            







            <hr/>
<section>
    <h2>Keep Reading</h2>
<ul class="related-posts-list">
<li><a href="https://datapile.coffeecrew.org/programming-with-the-apr" title="Programming with the APR">Programming with the APR</a></li>
<li><a href="https://datapile.coffeecrew.org/programming-with-the-apr-using-apr_getopt" title="Programming with the APR - Using apr_getopt">Programming with the APR - Using apr_getopt</a></li>
<li><a href="https://datapile.coffeecrew.org/programming-with-the-apr-using-md5" title="Programming with the APR - Using MD5">Programming with the APR - Using MD5</a></li>
<li><a href="https://datapile.coffeecrew.org/programming-with-the-apr-using-apr-hashtables" title="Programming with the APR - Using APR HashTables">Programming with the APR - Using APR HashTables</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://datapile.coffeecrew.org/programming-with-the-apr" title="Previous: Programming with the APR">Programming with the APR</a></li>
                <li class="next-article"><a href="https://datapile.coffeecrew.org/programming-with-the-apr-using-apr_getopt" title="Next: Programming with the APR - Using apr_getopt">Programming with the APR - Using apr_getopt</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2010-11-01T11:00:34+01:00">Nov 01, 2010</time>
            <h4>Category</h4>
            <a class="category-link" href="https://datapile.coffeecrew.org/categories#programming-ref">Programming</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://datapile.coffeecrew.org/tags#apache-ref">Apache
                    <span class="superscript">5</span>
</a></li>
                <li><a href="https://datapile.coffeecrew.org/tags#apr-ref">APR
                    <span class="superscript">5</span>
</a></li>
                <li><a href="https://datapile.coffeecrew.org/tags#c-ref">C
                    <span class="superscript">5</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/authsec/" title="Authsec Github Repository" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/authsec" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jens-frey-409ab844/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://www.youtube.com/jensfrey" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="YouTube" role="img" viewBox="0 0 512 512" fill="#ed1d24"><rect width="512" height="512" rx="15%"/><path d="m427 169c-4-15-17-27-32-31-34-9-239-10-278 0-15 4-28 16-32 31-9 38-10 135 0 174 4 15 17 27 32 31 36 10 241 10 278 0 15-4 28-16 32-31 9-36 9-137 0-174" fill="#fff"/><path d="m220 203v106l93-53"/></svg>
    </a>
    <a href="http://localhost:8000/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Content licensed under <a rel="license nofollow noopener noreferrer"
    href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
    Creative Commons Attribution 4.0 International License</a>.
    </div>

    <div>
        <span class="site-name">Datapile</span> - Against Digital Amnesia
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
        Hosted on:
        <a href=https://datapile.coffeecrew.org/ target="_blank" rel="nofollow noopener noreferrer">
            Github
        </a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://datapile.coffeecrew.org/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>